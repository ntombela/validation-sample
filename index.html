<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <link href="css/style.css" rel="stylesheet" />
    <style>
      .error-field {
        margin: 10px 0;
      }

      #message {
        display: none;
        padding: 2px;
        margin-top: 0px;
      }

      #message b {
        padding: 0px 15px;
        font-size: 14px;
      }

      .valid {
        color: green;
      }

      .valid:before {
        position: relative;
        left: -5px;
        content: "✔";
      }

      .invalid {
        color: red;
      }

      .invalid:before {
        position: relative;
        left: -5px;
        content: "✖";
      }

      #debug {
        color: red;
        display: none;
        font-size: 14px;
      }
    </style>
  </head>
  <div class="modal-body mx-3">
    <form
      method="POST"
      autocomplete="off"
      role="form"
      id="register-add"
      name="register-add"
      action="register-add"
      autocomplete="off"
      validate="true"
    >
      <div class="row">
        <div class="card-body">
          <div class="col-md-12 col-sm-12">
            <div class="row">
              <div class="form-group col-md-6">
                <label for="userIdType" class="form-label"
                  >ID Number Type<span style="color: red">*</span></label
                >
                <div class="form-group">
                  <select
                    class="form-control"
                    id="userIdType"
                    name="userIdType"
                    required
                  >
                    <option selected value="">Select Id Type</option>
                    <option value="IdNumber">ID Number</option>
                    <option value="Passport">Passport</option>
                  </select>
                  <div class="invalid-feedback">
                    Please select a ID Number Type.
                  </div>
                </div>
              </div>
              <div id="otherTypeID" class="form-group col-md-6">
                <label for="userIdType"
                  >ID Number/Passport Number<span style="color: red"
                    >*</span
                  ></label
                >
                <input
                  type="text"
                  class="form-control"
                  id="IdNumber"
                  name="IdNumber"
                  placeholder="ID Number/Passport Number"
                  required
                />
                <!-- <div class="invalid-feedback" id="debug">
                  Please provide Id Number
                </div> -->
              </div>
              <div class="form-group col-md-6">
                <label for="txt1"
                  >Email Address<span style="color: red">*</span></label
                >
                <input
                  type="email"
                  class="form-control"
                  id="txt1"
                  name="email"
                  onkeyup="sum();"
                  required
                />
                <div class="invalid-feedback">Please provide Email Address</div>
              </div>
              <div class="form-group col-md-6">
                <label for="txt3"
                  >Username<span style="color: red">*</span></label
                >
                <input
                  type="email"
                  class="form-control"
                  id="txt3"
                  name="email"
                  readonly
                  required
                />
                <div class="invalid-feedback">Please provide password</div>
              </div>
              <div class="form-group col-md-6">
                <label for="pass"
                  >Password<span style="color: red">*</span></label
                >
                <input
                  type="password"
                  class="form-control"
                  id="pass"
                  name="pass"
                  pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                  title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"
                  required
                />
                <div class="invalid-feedback">Please provide password</div>
              </div>
              <div class="form-group col-md-6">
                <label for="cpass" class="form-label"
                  >Confirm Password<span style="color: red">*</span></label
                >
                <input
                  class="form-control"
                  type="password"
                  id="cpass"
                  name="cpass"
                  pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                  title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"
                  required
                />
                <div class="invalid-feedback">Please provide password</div>
                <div id="CheckPasswordMatch"></div>
              </div>
            </div>
            <div class="form-group col-md-12" id="message">
              Password must contain the following:
              <b id="letter" class="invalid">lowercase letter,</b
              ><b id="capital" class="invalid">capital (uppercase) letter,</b
              ><b id="number" class="invalid">number,</b
              ><b id="length" class="invalid">Minimum 8 characters</b>
            </div>
          </div>
          <div class="form-group col-md-6">
            <div class="form-group">
              <div class="input-group">
                <input
                  autocomplete="off"
                  autocomplete="false"
                  type="hidden"
                  class="form-control"
                  name="userRole"
                  id="userRole"
                  value="users"
                />
                <button
                  type="submit"
                  class="btn btn-primary"
                  id="btn-users"
                  name="btn-users"
                >
                  Submit
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
  <script type="text/javascript">
    function sum() {
      var txtFirstNumberValue = document.getElementById("txt1").value;
      var result = txtFirstNumberValue;
      document.getElementById("txt3").value = result;
    }
    // Example starter JavaScript for disabling form submissions if there are invalid fields
    (function () {
      "use strict";

      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.querySelectorAll(".needs-validation");

      // Loop over them and prevent submission
      Array.prototype.slice.call(forms).forEach(function (form) {
        form.addEventListener(
          "submit",
          function (event) {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }

            form.classList.add("was-validated");
          },
          false
        );
      });
    })();
  </script>
  <script>
    // var myInput = document.getElementById("cpass");
    var myInput = document.getElementById("pass");
    var letter = document.getElementById("letter");
    var capital = document.getElementById("capital");
    var number = document.getElementById("number");
    var length = document.getElementById("length");

    // When the user clicks on the password field, show the message box
    myInput.onfocus = function () {
      document.getElementById("message").style.display = "block";
    };

    // When the user clicks outside of the password field, hide the message box
    myInput.onblur = function () {
      document.getElementById("message").style.display = "none";
    };

    // When the user starts to type something inside the password field
    myInput.onkeyup = function () {
      // Validate lowercase letters
      var lowerCaseLetters = /[a-z]/g;
      if (myInput.value.match(lowerCaseLetters)) {
        letter.classList.remove("invalid");
        letter.classList.add("valid");
      } else {
        letter.classList.remove("valid");
        letter.classList.add("invalid");
      }

      // Validate capital letters
      var upperCaseLetters = /[A-Z]/g;
      if (myInput.value.match(upperCaseLetters)) {
        capital.classList.remove("invalid");
        capital.classList.add("valid");
      } else {
        capital.classList.remove("valid");
        capital.classList.add("invalid");
      }

      // Validate numbers
      var numbers = /[0-9]/g;
      if (myInput.value.match(numbers)) {
        number.classList.remove("invalid");
        number.classList.add("valid");
      } else {
        number.classList.remove("valid");
        number.classList.add("invalid");
      }

      // Validate length
      if (myInput.value.length >= 8) {
        length.classList.remove("invalid");
        length.classList.add("valid");
      } else {
        length.classList.remove("valid");
        length.classList.add("invalid");
      }
    };
    function validateRSAIdNumber() {
      $("#debug").empty();

      // the anatomy of an RSA ID Number : http://warwickchapman.com/the-anatomy-of-an-rsa-id-number
      // structure: (YYMMDD GSSS CAZ)

      var IdNumber = $("#IdNumber").val(),
        invalid = 0;

      // display debugging
      var debug = $("#debug");

      // check that value submitted is a number
      if (isNaN(IdNumber)) {
        debug.append("Value supplied is not a valid number.<br />");
        invalid++;
      }

      // check length of 13 digits
      if (IdNumber.length != 13) {
        debug.append("Number supplied must contain 13 digits. ");
        invalid++;
      }

      // check that YYMMDD group is a valid date
      var yy = IdNumber.substring(0, 2),
        mm = IdNumber.substring(2, 4),
        dd = IdNumber.substring(4, 6);

      var dob = new Date(yy, mm - 1, dd);

      // check values - add one to month because Date() uses 0-11 for months
      if (
        !(
          (dob.getFullYear() + "").substring(2, 4) == yy &&
          dob.getMonth() == mm - 1 &&
          dob.getDate() == dd
        )
      ) {
        // debug.append('Date in first 6 digits is invalid.<br />');
        invalid++;
      }

      // evaluate GSSS group for gender and sequence
      var gender = parseInt(IdNumber.substring(6, 10), 10) > 5000 ? "M" : "F";

      // ensure third to last digit is a 1 or a 0
      if (IdNumber.substring(10, 11) > 1) {
        // debug.append('Third to last digit can only be a 0 or 1 but is a ' + IdNumber.substring(10, 11) + '.<br />');
        invalid++;
      } else {
        // determine citizenship from third to last digit (C)
        var saffer = parseInt(IdNumber.substring(10, 11), 10) === 0 ? "C" : "F";
      }

      // ensure second to last digit is a 8 or a 9
      if (IdNumber.substring(11, 12) < 8) {
        // debug.append('Second to last digit can only be a 8 or 9 but is a ' + IdNumber.substring(11, 12) + '.<br />');
        invalid++;
      }

      // calculate check bit (Z) using the Luhn algorithm
      var ncheck = 0,
        beven = false;

      for (var c = IdNumber.length - 1; c >= 0; c--) {
        var cdigit = IdNumber.charAt(c),
          ndigit = parseInt(cdigit, 10);

        if (beven) {
          if ((ndigit *= 2) > 9) ndigit -= 9;
        }

        ncheck += ndigit;
        beven = !beven;
      }

      if (ncheck % 10 !== 0) {
        debug.append("Id Number Not Valid.<br />");
        invalid++;
      }

      // if one or more checks fail, display details
      if (invalid > 0) {
        debug.css("display", "block");
        $("#IdNumber").css("border", "1px solid red !important");
      }

      return ncheck % 10 === 0;
    }

    jQuery.validator.addMethod(
      "idNumber",
      function (value, element) {
        return this.optional(element) || validateRSAIdNumber();
      },
      "Please enter a valid SA Identity Number."
    );

    $("#register-add").validate({
      rules: {
        IdNumber: {
          idNumber: {
            depends: function (element) {
              return $("#userIdType").val() === "IdNumber";
            },
          },
        },
      },
    });
  </script>
</html>
